# MVP Онлайн-магазина рекламных пакетов

Этот проект реализует упрощённый онлайн-магазин для покупки рекламных пакетов.  
Пользователи могут авторизоваться через Google Oauth, создать заказ на рекламный пакет, оплатить его через Stripe (в тестовом режиме) и получить уведомление об изменении статуса заказа через Telegram-бота.  

Система построена с использованием **микросервисной архитектуры**, чтобы продемонстрировать разделение ответственности, аутентификацию, обмен сообщениями и интеграцию с платежами.

---

## Основные возможности

- **Auth-service (Сервис аутентификации)**: Авторизация через OAuth Google. Выдаёт JWT access/refresh токены с ролями (user/admin).
- **Billing-service (Сервис биллинга)**: Управляет заказами, создаёт платежные Intent-ы в Stripe, обрабатывает вебхуки для обновления статуса заказа (`created → paid/failed`), гарантирует идемпотентность при повторных событиях и публикует события в брокер сообщений.
- **Bot-service (Сервис бота)**: Подписывается на события `order.paid` из очереди и отправляет уведомления в Telegram.
- **Message Broker (Брокер сообщений)**: RabbitMQ для событий `order.created` и `order.paid`.
- **База данных**: PostgreSQL для хранения пользователей (в `auth-service`) и заказов (в `billing-service`).
- **OpenAPI/Swagger**: Доступен для каждого сервиса для документирования API.

Архитектура следует принципам **чистой/гексагональной архитектуры**:
- `domain` → бизнес-логика  
- `application` → сценарии использования  
- `infrastructure` → внешние интеграции (БД, брокер, Stripe)  
- `presentation` → API-роуты  

---

## Локальный запуск

### Требования
- Docker & Docker Compose
- Тестовый аккаунт Stripe
- OAuth-ключи для Google

Запуск
# Сборка и запуск всех сервисов
```console
docker compose build
docker compose up -d
```

# Применение миграций
```console
docker compose exec auth-service uv run alembic upgrade head
docker compose exec billing-service uv run alembic upgrade head
```
